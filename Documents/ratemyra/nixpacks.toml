[phases.setup]
nixPkgs = ["nodejs-18_x"]

[phases.install]
cmds = [
  "npm install || true",
  "(cd server && npm install)",
  "(cd client && npm install)"
]

[phases.build]
cmds = [
  "echo 'ğŸ”¨ Starting build phase...'",
  "echo 'ğŸ“¦ Building Prisma client...'",
  "(cd server && npx prisma generate || echo 'âš ï¸ Prisma generate failed (non-critical)')",
  "echo 'ğŸ¨ Building frontend...'",
  "(cd client && rm -rf dist && npm run build)",
  "echo 'âœ… Verifying build output...'",
  "(cd client && test -d dist && echo 'âœ… dist/ folder exists' && ls -la dist/ | head -10 || (echo 'âŒ dist/ folder NOT found!' && exit 1))",
  "echo 'âœ… Build phase completed successfully!'"
]

[phases.release]
cmds = [
  "(cd server && (test -n \"$DATABASE_URL\" && npx prisma migrate deploy || echo 'Skipping migrations - DATABASE_URL not set'))"
]

[start]
cmd = "cd server && npm start"
