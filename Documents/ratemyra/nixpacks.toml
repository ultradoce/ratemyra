[phases.setup]
# Let Nixpacks auto-detect Node.js version from package.json engines or .node-version

[phases.install]
cmds = [
  "npm install || true",
  "(cd server && npm install)",
  "(cd client && npm install)"
]

[phases.build]
cmds = [
  "cd server && npx prisma generate || echo 'Prisma generate failed (non-critical)'",
  "cd client && rm -rf dist && npm run build",
  "cd client && test -d dist || (echo 'Build failed: dist/ folder not found' && exit 1)"
]

[phases.release]
cmds = [
  "cd server && npx prisma migrate deploy || echo 'Migration failed - can be run via /api/setup'"
]

[start]
cmd = "cd server && npm start"
