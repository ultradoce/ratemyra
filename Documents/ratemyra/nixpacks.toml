[phases.setup]
nixPkgs = ["nodejs-18_x"]

[phases.install]
cmds = [
  "npm install || true",
  "(cd server && npm install)",
  "(cd client && npm install)"
]

[phases.build]
cmds = [
  "(cd server && npx prisma generate)",
  "(cd client && npm run build)"
]

[phases.release]
cmds = [
  "(cd server && (test -n \"$DATABASE_URL\" && npx prisma migrate deploy || echo 'Skipping migrations - DATABASE_URL not set'))"
]

[start]
cmd = "cd server && npm start"
